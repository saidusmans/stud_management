{% extends 'core/base.html' %}
{% block content %}
<h2>Mark Attendance for Today</h2>

{% if success %}
<p style="color: green;">Attendance saved successfully!</p>
{% endif %}

<!-- ðŸ”Ž Search bar -->
<input type="text" id="studentSearch" placeholder="Search by Roll No or Name"
       style="margin-bottom: 10px; padding: 5px; width: 50%;" onkeyup="filterStudents()">

<form method="post">
    {% csrf_token %}
    <table border="1" cellpadding="8" cellspacing="0" id="studentTable" style="width: 100%; text-align: center;">
        <thead style="background-color: #f2f2f2;">
            <tr>
                <th>Roll No</th>
                <th>Student Name</th>
                <th>Present</th>
            </tr>
        </thead>
        <tbody>
        {% for student in students %}
            <tr>
                <td>{{ student.roll_no }}</td>
                <td>{{ student.name }}</td>
                <td>
                    <input type="checkbox" name="student_{{ student.id }}">
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <br>
    <button type="submit">Save Attendance</button>
</form>


<!-- JavaScript for search filter -->
<script>
function filterStudents() {
    let input = document.getElementById("studentSearch");
    let filter = input.value.toLowerCase();
    let table = document.getElementById("studentTable");
    let tr = table.getElementsByTagName("tr");

    for (let i = 1; i < tr.length; i++) { // skip header row
        let tdRoll = tr[i].getElementsByTagName("td")[0];
        let tdName = tr[i].getElementsByTagName("td")[1];
        if (tdRoll || tdName) {
            let rollText = tdRoll.textContent || tdRoll.innerText;
            let nameText = tdName.textContent || tdName.innerText;
            if (rollText.toLowerCase().indexOf(filter) > -1 || 
                nameText.toLowerCase().indexOf(filter) > -1) {
                tr[i].style.display = "";
            } else {
                tr[i].style.display = "none";
            }
        }
    }
}
</script>

{% endblock %}

